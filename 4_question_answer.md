[![https://gyazo.com/f2be3507fd3218aa864562bae162fc4d](https://i.gyazo.com/f2be3507fd3218aa864562bae162fc4d.png)](https://gyazo.com/f2be3507fd3218aa864562bae162fc4d)

> なぜ2乗しているのか

結論から言えば、それが関数の式を求める近道だからです。
試しに、2乗しない形で、

$y_i - (ax_i + b)$

の総和を最小にする$a$,$b$を求めます。
すると、

$n| y_i - (ax_i + b) |$

となります。  
しかし、この形では、式を最小にする$a$,$b$を求めることは困難です。  
そこで、差の絶対値の総和の2乗を計算してみます。すると(途中式は省きます)、

$n\{ b - ( \bar{y} - a \bar{x} ) \}^2 + \left ( \sum x_i^2 - n \bar{x}^2 \right ) \left\{ a - \frac{ \sum x_i y_i - n \bar{x}\bar{y} }{ \sum x_i^2 - n \bar{x}^2 } \right\}^2$
$+ \sum y_i^2 - n \bar{y}^2 - \frac{ (\sum x_i y_i - n
\bar{x}\bar{y})^2 }{ \sum x_i^2 - n \bar{x}^2 }$

となります。ただし、  

$\sum x_i = n \bar{x}$, $\sum y_i = n \bar{y}$

としてます。
この式から、

$a = \frac{ \sum x_i y_i - n \bar{x}\bar{y} }{ \sum x_i^2 - n \bar{x}^2 }$

$b = \bar{y} - a \bar{x}$

と定めると、総和の2乗は最小になることが分かります。
ここで、統計学の知識から、$a$の分母は分散の形になっており、分子は共分散の形になっています。
このように、2乗すると$a$,$b$を求めることができました。

また、

> なぜ最後に2で割っているのか

についてですが、こちらは式を微分する際に役立ちます。  
総和が()^2の形で表される場合、微分すると()の右肩の2が前に掛けられ、$1/2$で打ち消されます。
2で割るという行為は、微分計算を楽にするための便利な道具のようなものです。
